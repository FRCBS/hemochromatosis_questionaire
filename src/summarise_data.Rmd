---
title: "Summary of hemochromatosis questionnaire answers"
author: "Elina Koskinen, Jonna Clancy and Mikko Arvas"
date: "`r Sys.time()`"
output:
  html_document:
    toc: true
    theme: united
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(gtsummary)
library(likert)
library(readxl)
library(here)
library(ggcorrplot)
library(GGally)
#library(responsesR)

```


# Data

## Import

```{r}
file <- here("data/Tulokset - hemokromatoosikysely vastaukset (ID 133620).xlsx")
data <- read_xlsx(file)

colnames(data)
```

```{r}
#remove open questions
data<- data %>% 
  select(
    -Kys8aFutureOpen,
    -Kys12aTrustOpen,
    -Kys13aMembertoBiobankOpen,
    -Kys15OtherWhere,
    -Kys21OtherResultsOpen,
    -Kys23SymptomsOpen,
    -Kys26cAttitudesinFamilyOpen
    
  )
summary(data)
```

 

## Process

```{r}

data <-  data %>% 
  rename(Kys20aBHFED = `Kys20aB-HFE-D`) %>% 
  mutate(
    Kys2Gender = factor(Kys2Gender),
    Kys3DonationCount = factor(Kys3DonationCount,ordered = TRUE),
    Kys9Useful = factor(
      Kys9Useful,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    Kys10Worry = factor(
      Kys10Worry,
      ordered = TRUE,
      #First you specify the levels in the original data , in the order that you want them to be
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      #Then you specify new names for them
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
      # > tmp$Kys10Worry
      #...
      # Levels: Totally agree < Partly agree < Neutral < Partly disagree < Totally disagree
      #> table(tmp$Kys10Worry)
      # 
      # Totally agree     Partly agree          Neutral  Partly disagree Totally disagree 
      # 3               12                0               10                5
    ),
    
    
    Kys11HealthPromotion = factor(
      Kys11HealthPromotion,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys16Flexibility = factor(
      Kys16Flexibility,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys17Support = factor(
      Kys17Support,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys18Answers = factor(
      Kys18Answers,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys24Influence = factor(
      Kys24Influence,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys25Motivation = factor(
      Kys25Motivation,
      ordered = TRUE,
      levels = rev(c("Strongly agree","Partly agree","Neither agree nor disagree","Partly disagree","Strongly disagree")),
      labels =  rev(c("Totally agree","Partly agree","Neutral","Partly disagree","Totally disagree"))
    ),
    
    Kys5HowOften = factor(
      Kys5HowOften,
      ordered = FALSE,
      levels = rev(c("More often than nowadays", "As per nowadays", "Less than nowadays", "Quitting donating blood because of the information received", "Quitting donating blood because of another reason, eg. Age or other barrier", "Can not tell")),
      labels = rev(c("More often than nowadays", "As per nowadays", "Less than nowadays", "Quitting donating blood because of the information received", "Quitting donating blood because of another reason", "Can not tell"))
    ),
    
    Kys6EasytoUnderstand = factor(
      Kys6EasytoUnderstand,
      ordered = TRUE,
      levels = c("No", "Can not tell", "Yes")
    ),
    
    Kys7Understanding = factor(
      Kys7Understanding,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys8Future = factor(
      Kys8Future,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys12Trust = factor(
      Kys12Trust,
      ordered = TRUE,
      levels = rev(c("Grown", "Partly grown", "Have not affected", "Partly decreased", "Decreased")),
      labels =  rev(c("Grown","Partly grown","Has not affected","Partly decreased","Decreased"))
    ),
    
    Kys13MembertoBiobank = factor(
      Kys13MembertoBiobank,
      ordered = TRUE,
      levels = rev(c("Grown", "Partly grown", "Have not affected", "Partly decreased", "Decreased")),
      labels =  rev(c("Grown","Partly grown","Has not affected","Partly decreased","Decreased"))
    ),
    
    Kys14Healthcare = factor(
      Kys14Healthcare,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys15aStudentHealth = factor(
      Kys15aStudentHealth,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys15bOccupational = factor(
      Kys15bOccupational,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys15cSpecialHealth = factor(
      Kys15cSpecialHealth,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys15dHealthCare = factor(
      Kys15dHealthCare,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys15ePrivate = factor(
      Kys15ePrivate,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    
    Kys19Attitude = factor(
      Kys19Attitude,
      ordered = TRUE,
      levels = rev(c("Positive", "Partly positive", "Neutral", "Partly negative", "Negative"))
    ),
    
    Kys20bDone= factor(
      Kys20bDone,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys20cDone= factor(
      Kys20cDone,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys20dDone= factor(
      Kys20dDone,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys20eDone= factor(
      Kys20eDone,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys20fDone= factor(
      Kys20fDone,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys22Diagnosis = factor(
      Kys22Diagnosis,
      ordered = FALSE,
      levels = c("Yes", "No", "Don't know")
    ),
    
    
    Kys23aTiredness = factor(
      Kys23aTiredness,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys23bJoint = factor(
      Kys23bJoint,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys23cType2DM = factor(
      Kys23cType2DM,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys26aFamily = factor(
      Kys26aFamily,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    
    Kys1Age	= as.numeric(Kys1Age),
    Kys4YearStarted = as.numeric(Kys4YearStarted),
    Kys20aBHFED = factor(
    Kys20aBHFED,
      ordered = FALSE,
      levels = c("Yes", "No")
    ),
    Kys20bFerrit = as.numeric(Kys20bFerrit),
    Kys20cTrfesat = as.numeric(Kys20cTrfesat),
    Kys20dHemoglobin = as.numeric(Kys20dHemoglobin),
    Kys20eMCV = as.numeric(Kys20eMCV),
    Kys20fALAT = as.numeric(Kys20fALAT),
    Kys26bNumberofRelatives = as.numeric(Kys26bNumberofRelatives)
  )

summary(data)
```



# Demographics



## Demographics Table 1

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Age =  Kys1Age,
      YearStarted = Kys4YearStarted,
      DonationCount = Kys3DonationCount
    ),
    include = c(
      Age,
      YearStarted,  
      DonationCount
      ),
    by =  Kys2Gender
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1

```



## Age by Gender


```{r}

p <- ggplot(data)
p <- p +  geom_histogram(aes(x=Kys1Age),binwidth = 5)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("Age in years")
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/age.png", dpi = 600,width =  160, height = 80,units = "mm")


```

## Scatterplot Age and Donation Count

```{r}

p <- ggplot(data)
p <- p + geom_point(aes(x=Kys1Age, y=Kys3DonationCount))
p <- p + xlab("Age")
p <- p + ylab("Donation Count")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + theme_bw() + facet_grid(.~Kys2Gender)
p <- p + theme(text = element_text(size = 20))
p

ggsave(plot = p,filename = "../results/AgeDonCount.png", dpi = 600,width =  160, height = 80,units = "mm")
```
# Picture of Age, DonCount and Ferritin

```{r}

p <- ggplot(data)
p <- p + geom_point(aes(x=Kys1Age, y=Kys3DonationCount, col=Kys20bFerrit),size = 4 )
p <- p + xlab("Age")
p <- p + ylab("Donation Count")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + theme_bw() + facet_grid(.~Kys2Gender)
p <- p + geom_smooth(formula = y~x, aes(x=Kys1Age, y=as.numeric(Kys3DonationCount)), method = "lm")


p

ggsave(plot = p,filename = "../results/AgeDonCount_lm_fer.png", dpi = 600,width =  160, height = 80,units = "mm")
```

# Picture of Age, DonCount, Ferritin and Diagnosis


```{r}

p <- ggplot(data)
p <- p + geom_point(aes(x=Kys1Age, y=Kys3DonationCount, col=Kys20bFerrit,shape=Kys22Diagnosis) ,size = 4 )
p <- p + xlab("Age")
p <- p + ylab("Donation Count")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + theme_bw() + facet_grid(.~Kys2Gender)
p <- p + geom_smooth(formula = y~x, aes(x=Kys1Age, y=as.numeric(Kys3DonationCount)), method = "lm")


p

ggsave(plot = p,filename = "../results/AgeDonCount_lm_fer.png", dpi = 600,width =  160, height = 80,units = "mm")
```


# Likert scales

## Question 5
```{r} 
items = data %>% 
  select(Kys5HowOften) %>% as.data.frame()
colnames(items) <- c(
  "How are you planning to continue blood donation after receiving the information about iron accumulation tendency?"
)
# How are you planning to continue blood donation after receiving the information about iron accumulation tendency?
nlevels = 6
```


```{r}
p <- ggplot(data)
p <- p + geom_bar(aes(y=Kys5HowOften))
p <- p + ylab("")
p <- p + xlab("How are you planning to continue \nblood donation after receiving the information \nabout iron accumulation tendency?")
p <- p + theme(plot.margin = unit(c(1,1,1,1),"cm"))
p <- p + scale_x_discrete(drop = FALSE)
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q05.png", dpi = 600,width =  160, height = 80,units = "mm")

```




## Table of Question 6

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      EasytoUnderstand = Kys6EasytoUnderstand
    ),
    include = c(
      EasytoUnderstand
      ),
 
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1

```

## Table of Question 7, 8

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Understanding =  Kys7Understanding,
      Future = Kys8Future
    ),
    include = c(
      Understanding,
      Future
      ),
 
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1

```

## Questions 9, 10, 11

```{r} 
items = data %>% 
  select(Kys9Useful, Kys10Worry, Kys11HealthPromotion) %>% as.data.frame()
colnames(items) <- c(
  "It was useful to receive genetic information",
  "Receiving genetic information did not worry me",
  "The genome data in biobank should be used more widely to promote health"
)

nlevels = 5
```

```{r}
q09 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
)

plot(q09, 
     type = "bar",
     wrap = 20,
     #legend.position = c(0.3, 0.7),
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=5,
     include.histogram = FALSE
) 

plot + theme(
  text = element_text(size = 20),
  axis.text = element_text(size = 12),
  axis.title = element_text(size = 16),
  legend.text = element_text(size = 12)
)

#tämä viimeisin ei tee mitään?
```


```{r}
png(filename = "../results/q09.png",
    units = "mm",
    width =  180, 
    height = 80,
    res=600
    )
plot(q09, 
     type = "bar",
     wrap = 20,
     #legend.position = c(0.3, 0.7),
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=2.5,
     include.histogram = FALSE) 
#dev.off()

```



## Questions 12, 13


```{r} 
items = data %>% 
  select(Kys12Trust, Kys13MembertoBiobank) %>% as.data.frame()
colnames(items) <- c(
  "How has receiving genetic information affected on your confidence in Blood Service?",
  "How has receiving genetic information affected your willingness to belong to Blood Service Biobank?"
)

nlevels = 5
```

```{r}
q09 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
)

plot(q09, 
     type = "bar",
     wrap = 27,
     legend.position = "bottom",
     legend = element_blank(),
     text.size=2,
     include.histogram = FALSE)

```
```{r}
png(filename = "../results/q12.png",
    units = "mm",
    width =  180, 
    height = 80,
    res=600
    )
plot(q09, 
     type = "bar",
     wrap = 27,
     #legend.position = c(0.3, 0.7),
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=2.5,
     include.histogram = FALSE) 
#dev.off()

```


## Table of only Q 15

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      StudentHealthCare = Kys15aStudentHealth,
      OccupationalHealthCare = Kys15bOccupational,
      SpecialHealthCare = Kys15cSpecialHealth,
      HealthCareCenter = Kys15dHealthCare,
      PrivateHealthCare = Kys15ePrivate
    ),
    include = c(
      StudentHealthCare,  
      OccupationalHealthCare,
      SpecialHealthCare,
      HealthCareCenter,
      PrivateHealthCare
      ),
   
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1
```

## Table of Q 14, 15

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      ApplyingtoHealthCare =  Kys14Healthcare,
      StudentHealthCare = Kys15aStudentHealth,
      OccupationalHealthCare = Kys15bOccupational,
      SpecialHealthCare = Kys15cSpecialHealth,
      HealthCareCenter = Kys15dHealthCare,
      PrivateHealthCare = Kys15ePrivate
    ),
    include = c(
      ApplyingtoHealthCare,
      StudentHealthCare,  
      OccupationalHealthCare,
      SpecialHealthCare,
      HealthCareCenter,
      PrivateHealthCare
      ),
  
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1
```


## Questions 16, 17, 18

```{r} 
items = data %>% 
  select(Kys16Flexibility, Kys17Support, Kys18Answers) %>% as.data.frame()
colnames(items) <- c(
  "My situation was taken care of fluently in health care",
  "I got enough support from health care",
  "My questions were answered in health care"
)

nlevels = 5
```

```{r}
q09 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
  
)

plot(q09, 
     type = "bar",
     wrap = 15,
     legend.position = "bottom",
     legend = element_blank(),
     text.size=2.5,
     include.histogram = FALSE)
```
```{r}
png(filename = "../results/q16.png",
    units = "mm",
    width =  180, 
    height = 80,
    res=600
    )
plot(q09, 
     type = "bar",
     wrap = 15,
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=2.5,
     include.histogram = FALSE) 
#dev.off()

```
## Question 19

```{r} 
items = data %>% 
  select(Kys19Attitude) %>% as.data.frame()
colnames(items) <- c(
  "In health care services, the attitude towards the returned information from Biobank was…"
)

nlevels = 5

```

```{r}
q09 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
  
)

plot(q09, 
     type = "bar",
     wrap = 15,
     legend.position = "bottom",
     legend = element_blank(),
     text.size=2.5,
     include.histogram = FALSE)
```
```{r}
png(filename = "../results/q19.png",
    units = "mm",
    width =  180, 
    height = 80,
    res=600
    )
plot(q09, 
     type = "bar",
     wrap = 15,
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=2.5,
     include.histogram = FALSE) 
#dev.off()

```
##  Question 22

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Diagnosis = Kys22Diagnosis
    ),
    include = c(
      Diagnosis
      ),
    by =  Kys2Gender
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1
```

## Question 23

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Tiredness =  Kys23aTiredness,
      JointPain = Kys23bJoint,
      Type2DM = Kys23cType2DM
    ),
    include = c(
      Tiredness,
      JointPain,  
      Type2DM
      ),
    by =  Kys2Gender
    
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1
```

## Questions 24, 25

```{r} 
items = data %>% 
  select(Kys24Influence, Kys25Motivation) %>% as.data.frame()
colnames(items) <- c(
  "I believe I can make an impact with my lifestyle to my predisposition to hemochromatosis",
  "Receiving genetic information motivates me to take care of my health better"
)


nlevels = 5
```


```{r}
q09 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
  
)

plot(q09, 
     type = "bar",
     wrap = 20,
     legend.position = "bottom",
     legend = element_blank(),
     text.size=2.5,
     include.histogram = FALSE)

```
```{r}
png(filename = "../results/q24.png",
    units = "mm",
    width =  180, 
    height = 80,
    res=600
    )
plot(q09, 
     type = "bar",
     wrap = 20,
     legend.position = c("bottom"),
     legend = element_blank(),
     #likert.options = 
     text.size=2.5,
     include.histogram = FALSE) 
#dev.off()

```
## Question 26

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Relatives = Kys26aFamily,
      NumberofRelatives = Kys26bNumberofRelatives
    ),
    include = c(
      Relatives,
      NumberofRelatives
      ),
    #by =  Kys2Gender
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1


```



# Distributions of lab values by gender


## Ferritin

```{r}

limits <- tibble(Kys2Gender = c("Male", "Male", "Female", "Female"),Kys20bFerrit=c(20,195,15,125))

p <- ggplot(data)
p <- p + geom_histogram(aes(x=Kys20bFerrit), binwidth = 10)
p <- p + facet_wrap(. ~ Kys2Gender,scales = "free")
p <- p + xlab("Ferritin µg/l")
p <-  p + geom_vline(data=limits,aes(xintercept= Kys20bFerrit), col="red")
#p <- p + scale_x_log10() + geom_vline(aes(xintercept = 15, col = "red")) + geom_vline(aes(xintercept = 1000, col = "red"))
#p <- p  + geom_vline(aes(xintercept = 15), col = "red") #+ geom_vline(aes(xintercept = 1000), col = "red")
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q20b.png", dpi = 600,width =  160, height = 80,units = "mm")

```   


```{r}

data %>% 
  filter(Kys22Diagnosis == "Yes" ) %>% 
  filter(Kys20bFerrit >= 50 ) %>%  
  group_by(Kys2Gender) %>% count()

```

## TrfSat


```{r}

p <- ggplot(data)
p <- p + geom_histogram(aes(x=Kys20cTrfesat), binwidth = 0.2)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("Transferrin saturation %")
p <- p + geom_vline(aes(xintercept = 15, col = "red")) + geom_vline(aes(xintercept = 50, col = "red"))
p <- p + theme_bw()
#samat viitevälit

p

ggsave(plot = p,filename = "../results/q20c.png", dpi = 600,width =  160, height = 80,units = "mm")

```  

```{r}

data %>% 
  filter(Kys22Diagnosis == "Yes" ) %>% 
  filter(Kys20cTrfesat >= 30 ) %>% # pitäskö olla 30 > vai 30 >=
  group_by(Kys2Gender) %>% count()

```


## Hb

```{r}


limits <- tibble(Kys2Gender = c("Male", "Male", "Female", "Female"),Kys20dHemoglobin=c(134,167,117,155))


p <- ggplot(data)
p <- p + geom_histogram(aes(x=Kys20dHemoglobin), binwidth = 5)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("Hemoglobin g/l") + xlim(110,180)
p <-  p + geom_vline(data=limits,aes(xintercept= Kys20dHemoglobin), col="red")
p <- p + theme_bw()
#p <- p + scale_x_log10() + geom_vline(aes(xintercept = 15, col = "red")) + geom_vline(aes(xintercept = 100, col = "red"))

p

ggsave(plot = p,filename = "../results/q20d.png", dpi = 600,width =  160, height = 80,units = "mm")

```  

## eMCV


```{r}

p <- ggplot(data)
p <- p + geom_histogram(aes(x=Kys20eMCV), binwidth = 2)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("MCV fl") + xlim(70,110)
#p <- p + scale_x_log10() + geom_vline(aes(xintercept = 82, col = "red")) + geom_vline(aes(xintercept = 98, col = "red"))
p <- p  + geom_vline(aes(xintercept = 82, col = "red")) + geom_vline(aes(xintercept = 98, col = "red"))
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q20e.png", dpi = 600,width =  160, height = 80,units = "mm")



``` 


## fALAT

```{r}

#tässä eri viiterajat miehet alle 50 / naiset alle 35
limits <- tibble(Kys2Gender = c("Male","Female"),Kys20fALAT=c(50,35))

p <- ggplot(data)
p <- p + geom_histogram(aes(x=Kys20fALAT), binwidth = 5)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("P-ALAT U/l")
p <-  p + geom_vline(data=limits,aes(xintercept= Kys20fALAT), col="red")
p <- p + theme_bw()
#p <- p + geom_vline(aes(xintercept = 15, col = "red")) + geom_vline(aes(xintercept = 50, col = "red"))

ggsave(plot = p,filename = "../results/q20f.png", dpi = 600,width =  160, height = 80,units = "mm")

p

``` 


# Donor with diagnosis and lab results

```{r}


p <- ggplot(data, aes(x = Kys22Diagnosis))
p <- p + geom_line(aes(y=Kys20bFerrit))
p <- p + geom_line(aes(y = Kys20cTrfesat))
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("Diagnosis") #+ xlim(110,180)
#p <-  p + geom_vline(data=limits,aes(xintercept= Kys20dHemoglobin), col="red")
p <- p + theme_bw()

p

```

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Diagnosis = Kys22Diagnosis,
      Ferritin = Kys20bFerrit,
      TransferrinSat = Kys20cTrfesat
    ),
    include = c(
      Diagnosis,
      Ferritin,
      TransferrinSat
      ),
    by =  Kys2Gender
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1


```

# Disributions of Yes/No questions

```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys6EasytoUnderstand))
p <- p + xlab("The received genetic information was easy to understand.")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + scale_x_discrete(drop = FALSE)
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q06.png", dpi = 600,width =  160, height = 80,units = "mm")


```

```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys7Understanding))
p <- p + xlab("When you gave your consent for biobank,\ndid you understand it could lead to\nreceiving information relevant to your health?")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + scale_x_discrete(drop = FALSE)
p <- p + theme_bw()

p

ggsave(plot = p,filename = "../results/q07.png", dpi = 600,width =  160, height = 80,units = "mm")

```

```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys8Future))
p <- p + xlab("Would you like to receive similar information\nin the future, should it appear?")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + scale_x_discrete(drop = FALSE)
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q08.png", dpi = 600,width =  160, height = 80,units = "mm")

```
```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys14Healthcare))
p <- p + xlab("After receiving the information, did you apply for health care?")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q14.png", dpi = 600,width =  160, height = 80,units = "mm")

```

```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys22Diagnosis))
p <- p + xlab("Did you get a clinical diagnosis\nfor hemochromatosis (ICD10: E83.1)?")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q22.png", dpi = 600,width =  160, height = 80,units = "mm")

```

```{r}

p <- ggplot(data)
p <- p + geom_bar(aes(x=Kys26aFamily))
p <- p + xlab("I have discussed about my predisposition\nto hemochromatosis with my close relatives.")
p <- p + theme(plot.margin = unit(c(1,2,1,2),"cm"))
p <- p + scale_x_discrete(drop = FALSE)
p <- p + theme_bw()
p

ggsave(plot = p,filename = "../results/q26.png", dpi = 600,width =  160, height = 80,units = "mm")


```

# Correlation matrix



```{r}

data_as_no <- data %>% 
    select(
    -releaseID,
    -vastaaja,
    -Kys4YearStarted,
    -Kys6EasytoUnderstand,
    -Kys7Understanding,
    -Kys8Future,
    -Kys14Healthcare,
    -Kys26aFamily,
    -Kys26bNumberofRelatives,
    -Kys15ePrivate,
    -Kys15aStudentHealth,
    -Kys15bOccupational,
    -Kys15cSpecialHealth,
    -Kys15dHealthCare,
    -Kys20dDone,
    -Kys20fDone,
    -Kys20bDone,
    -Kys20cDone,
    -Kys20eDone,
    -Kys20bFerrit,
    -Kys20cTrfesat,
    -Kys20dHemoglobin,
    -Kys20eMCV,
    -Kys20fALAT,
    -Kys23cType2DM,
    -Kys23aTiredness,
    -Kys23bJoint,
    -Kys20aBHFED     
    ) %>% 
  mutate(across(everything(), ~ as.numeric(.x))) %>% 
  na.omit() %>% 
  rename(
    Q1_Age = Kys1Age,
    Q2_Gender = Kys2Gender,
    Q3_DonationCount = Kys3DonationCount,
    Q5_Frequency = Kys5HowOften,
    Q9_Usefulness = Kys9Useful,
    Q10_Worry = Kys10Worry,
    Q11_HealthPromotion = Kys11HealthPromotion,
    Q12_Confidence = Kys12Trust,
    Q13_MembertoBiobank = Kys13MembertoBiobank,
    Q16_Flexibility = Kys16Flexibility,
    Q17_Support = Kys17Support,
    Q18_Answers = Kys18Answers,
    Q19_Attitude = Kys19Attitude,
    Q22_Diagnosis = Kys22Diagnosis,
    Q24_Influence = Kys24Influence,
    Q25_Motivation = Kys25Motivation
    
  )
  
  

summary(data_as_no)
```


```{r}

corr <- round(cor(data_as_no), 1)
p.mat <- cor_pmat(data_as_no)

```



```{r}
ggcorrplot(corr, hc.order = TRUE, type = "lower",
   lab = TRUE)
```


```{r}
ggcorrplot(corr, hc.order = TRUE,
    type = "lower", p.mat = p.mat, sig.level = 0.01)
```


```{r}
corr_plot <- ggcorrplot(corr, p.mat = p.mat, hc.order = TRUE, lab = TRUE,
    type = "lower", insig = "blank", sig.level = 0.01)

ggsave(plot = corr_plot, filename = "../results/corr.png", width = 8, height = 6)

```


```{r}

tmp <- data_as_no %>% 
    select(
    Q1_Age,
    Q2_Gender,
    Q3_DonationCount,
    Q5_Frequency,
    Q12_Confidence,
    Q13_MembertoBiobank,
    Q16_Flexibility,
    Q17_Support,
    Q18_Answers
   
    
) %>% 
  mutate(
    Q2_Gender  = as.factor(Q2_Gender)
  )

my_fn <- function(data, mapping, method="loess", ...){
      p <- ggplot(data = data, mapping = mapping) + 
      geom_point() + 
      geom_smooth(method=method, ...)
      p
    }

ggpairs(
  tmp ,
  columns = 2:ncol(tmp),
  ggplot2::aes(colour = Q2_Gender),
  lower = list(continuous = my_fn)
)


```

It is an artefact created by a single outlier.


```{r}

tmp <- data_as_no %>% 
    select(
    Q2_Gender,
    Q1_Age,
    Q3_DonationCount,
    Q5_Frequency,
    Q10_Worry,
    Q11_HealthPromotion,
    Q17_Support,
    Q16_Flexibility,
    Q18_Answers,
    Q24_Influence,
    Q25_Motivation
) %>% 
  mutate(
    Q2_Gender = as.factor(Q2_Gender)
  )

my_fn <- function(data, mapping, method="loess", ...){
      p <- ggplot(data = data, mapping = mapping) + 
      geom_point() + 
      geom_smooth(method=method, ...)
      p
    }

ggpairs(
  tmp ,
  columns = 2:ncol(tmp),
  ggplot2::aes(colour = Q2_Gender),
  lower = list(continuous = my_fn)
)



```

```{r}

tmp <- data_as_no %>% 
    select(
    Kys2Gender,
    Kys1Age,
    Kys10Worry,
    Kys11HealthPromotion,
    Kys17Support,
    Kys16Flexibility,
    Kys18Answers,
    Kys24Influence,
    Kys25Motivation
) %>% 
  mutate(
    Kys2Gender = as.factor(Kys2Gender)
  )

my_fn <- function(data, mapping, method="loess", ...){
      p <- ggplot(data = data, mapping = mapping) + 
      geom_point() + 
      geom_smooth(method=method, ...)
      p
    }

ggpairs(
  tmp ,
  columns = 2:ncol(tmp),
  title = "Testiotsikko",
  ggplot2::aes(colour = Kys2Gender),
  lower = list(continuous = my_fn)
)


```

